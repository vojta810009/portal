<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="cs" lang="cs">  
<head>  
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">    
  <title>SFRI.gov - Portál vlády</title>  
  <link href="./styl.css" rel="stylesheet" type="text/css">  
  <link href="style-portal.css" rel="stylesheet" type="text/css">  
  <style>  
    #portalContent { display: none; }  
    #logoutTimer { font-weight: bold; color: yellow; }  
    
    /* ZÁKLADNÍ STYLY */
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: #f5f5f5;
    }
    
    /* HORNÍ LIŠTA */
    .top-bar {
      background: #8b0000;
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    
    .top-bar-info {
      display: flex;
      gap: 20px;
      align-items: center;
    }
    
    .top-bar-buttons {
      display: flex;
      gap: 10px;
    }
    
    .top-bar button {
      background: #c00;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }
    
    .top-bar button:hover {
      background: #a00;
    }
    
    /* ZÁLOŽKY */
    .tabs { 
      display: flex; 
      background: #e0e0e0; 
      padding: 0 20px;
      border-bottom: 2px solid #c00;
      flex-wrap: wrap;
    }
    
    .tab { 
      padding: 12px 24px; 
      background: #d0d0d0; 
      cursor: pointer; 
      margin-right: 2px; 
      border-radius: 5px 5px 0 0;
      font-weight: bold;
      white-space: nowrap;
    }
    
    .tab:hover { 
      background: #c0c0c0; 
    }
    
    .tab.active { 
      background: #c00; 
      color: white; 
    }
    
    /* OBSAH */
    .tab-content { 
      display: none; 
      padding: 20px; 
      min-height: 400px;
    }
    
    .tab-content.active { 
      display: block; 
    }
    
    /* OSOBNÍ INFORMACE */
    .personal-info {
      background: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .personal-info table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .personal-info td {
      padding: 8px;
      border-bottom: 1px solid #eee;
    }
    
    /* NOVINKY */
    .news-section {
      background: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .news-item {
      margin-bottom: 20px;
      padding: 15px;
      border-left: 4px solid #c00;
      background: #f9f9f9;
    }
    
    .news-title {
      color: #c00;
      margin: 0 0 10px 0;
    }
    
    .news-date {
      color: #666;
      font-size: 0.9em;
      margin-bottom: 10px;
    }
    
    .news-text {
      line-height: 1.5;
    }
    
    .news-attachment {
      margin-top: 10px;
      padding: 8px;
      background: #e9e9e9;
      border-radius: 4px;
      font-size: 0.9em;
    }
    
    .news-attachment a {
      color: #c00;
      text-decoration: none;
      font-weight: bold;
    }
    
    .news-attachment a:hover {
      text-decoration: underline;
    }
    
    /* ADMINISTRACE - OBECNÉ */
    .admin-section {
      background: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .admin-form {
      margin-bottom: 30px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 5px;
    }
    
    .admin-form input[type="text"],
    .admin-form input[type="password"],
    .admin-form input[type="number"],
    .admin-form select,
    .admin-form textarea {
      width: 100%;
      max-width: 500px;
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
      box-sizing: border-box;
    }
    
    .admin-form textarea {
      height: 100px;
      resize: vertical;
    }
    
    .admin-form button {
      background: #c00;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      font-size: 16px;
      margin-right: 10px;
      margin-bottom: 5px;
    }
    
    .admin-form button:hover {
      background: #a00;
    }
    
    .admin-form button.secondary {
      background: #666;
    }
    
    .admin-form button.secondary:hover {
      background: #555;
    }
    
    .admin-form button.warning {
      background: #ff9800;
    }
    
    .admin-form button.warning:hover {
      background: #f57c00;
    }
    
    .admin-form button.success {
      background: #4caf50;
    }
    
    .admin-form button.success:hover {
      background: #45a049;
    }
    
    /* ADMIN - SPRÁVA ÚČTŮ */
    .accounts-list {
      margin-top: 20px;
    }
    
    .account-item {
      padding: 15px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: #f9f9f9;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .account-info {
      flex: 1;
    }
    
    .account-actions {
      display: flex;
      gap: 10px;
    }
    
    /* TRANSAKCE */
    .transactions-section {
      background: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .transaction-item {
      padding: 15px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: #f9f9f9;
    }
    
    .transaction-pending {
      border-left: 4px solid #ff9800;
    }
    
    .transaction-approved {
      border-left: 4px solid #4caf50;
    }
    
    .transaction-rejected {
      border-left: 4px solid #f44336;
    }
    
    .transaction-negative {
      border-left: 4px solid #f44336;
      background: #ffe6e6;
    }
    
    .transaction-positive {
      border-left: 4px solid #4caf50;
      background: #e8f5e8;
    }
    
    .transaction-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    
    .transaction-actions {
      margin-top: 10px;
      display: flex;
      gap: 10px;
    }
    
    .transaction-actions button {
      padding: 5px 15px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }
    
    .btn-approve {
      background: #4caf50;
      color: white;
    }
    
    .btn-reject {
      background: #f44336;
      color: white;
    }
    
    /* LOGIN */
    .login-section {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #8b0000 0%, #c00 100%);
    }
    
    .login-box {
      background: white;
      padding: 40px;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      text-align: center;
      max-width: 400px;
      width: 90%;
    }
    
    .login-box h1 {
      color: #8b0000;
      margin-bottom: 20px;
    }
    
    .login-box input[type="text"],
    .login-box input[type="password"] {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
      box-sizing: border-box;
    }
    
    .login-box button {
      background: #c00;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      margin-top: 10px;
      width: 100%;
    }
    
    .login-box button:hover {
      background: #a00;
    }
    
    .login-logo {
      width: 200px;
      margin-bottom: 20px;
    }
    
    /* STATUS ZPRÁVY */
    .status-message {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      display: none;
    }
    
    .status-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .status-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    /* TABULKY */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    
    .data-table th {
      background: #8b0000;
      color: white;
      padding: 10px;
      text-align: left;
    }
    
    .data-table td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
    }
    
    .data-table tr:hover {
      background: #f5f5f5;
    }
    
    /* FILTROVÁNÍ */
    .filter-section {
      background: #f9f9f9;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 5px;
    }
    
    .filter-section input,
    .filter-section select {
      padding: 8px;
      margin-right: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    
    /* TRANSACTION TYPE INDICATOR */
    .transaction-type {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 0.8em;
      font-weight: bold;
      margin-left: 10px;
    }
    
    .type-payment {
      background: #4caf50;
      color: white;
    }
    
    .type-penalty {
      background: #f44336;
      color: white;
    }
    
    .type-transfer {
      background: #2196f3;
      color: white;
    }
    
    /* AMOUNT DISPLAY */
    .amount-positive {
      color: #4caf50;
      font-weight: bold;
    }
    
    .amount-negative {
      color: #f44336;
      font-weight: bold;
    }
    
    /* RECIPIENT SELECT */
    .recipient-type-selector {
      margin-bottom: 10px;
    }
    
    .recipient-type-selector button {
      margin-right: 5px;
      padding: 5px 10px;
      background: #ddd;
      border: none;
      border-radius: 3px;
      cursor: pointer;
    }
    
    .recipient-type-selector button.active {
      background: #c00;
      color: white;
    }
    
    /* CHANGE PASSWORD */
    .change-password-form {
      margin-top: 30px;
      padding: 20px;
      background: #f0f8ff;
      border-radius: 5px;
      border: 1px solid #cce7ff;
    }
    
    .change-password-form h3 {
      margin-top: 0;
      color: #0066cc;
    }
    
    /* SAVE INDICATOR */
    .save-indicator {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #4caf50;
      color: white;
      padding: 10px 15px;
      border-radius: 5px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      display: none;
      z-index: 1000;
    }
    
    .save-indicator.error {
      background: #f44336;
    }
    
    /* SETTINGS */
    .settings-section {
      background: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .settings-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .settings-card {
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 5px;
      background: #f9f9f9;
    }
    
    .settings-card h4 {
      margin-top: 0;
      color: #8b0000;
      border-bottom: 2px solid #c00;
      padding-bottom: 10px;
    }
    
    /* BACKUP */
    .backup-controls {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
  </style>  
</head>  
<body role="application">
  
  <!-- INDIKÁTOR UKLÁDÁNÍ -->
  <div id="saveIndicator" class="save-indicator">
    <span id="saveMessage">Ukládám...</span>
  </div>
  
  <!-- LOGIN SEKCE -->  
  <div id="loginSection" class="login-section">
    <div class="login-box">
      <h1>Vítejte v Portálu vlády SFRI</h1>
      <img class="login-logo" src="SFRI-male.png" alt="Logo SFRI">
      <h3>"Socialistická Federativní Republika IngLAND"</h3>
      
      <div id="loginStatus" class="status-message"></div>
      
      <input type="text" id="username" placeholder="ID občana">
      <input type="password" id="password" placeholder="Heslo">
      <button onclick="checkLogin()">Přihlásit se</button>
    </div>
  </div>
  
  <!-- PORTÁL VLÁDY SEKCE -->  
  <div id="portalContent">
    <!-- HORNÍ LIŠTA -->
    <div class="top-bar">
      <div class="top-bar-info">
        Přihlášen jako: <strong id="userFullName">---</strong>
        | Odhlášení za: <strong id="logoutTimer">--:--</strong>
      </div>
      <div class="top-bar-buttons">
        <button onclick="switchToTab('settings')" style="background: #2196f3;">Nastavení</button>
        <button onclick="switchToTab('news')">Portál vlády</button>
        <button onclick="logout()">Odhlášení</button>
      </div>
    </div>
    
    <!-- NAVIGAČNÍ ZÁLOŽKY -->
    <div class="tabs">
      <div class="tab active" data-tab="personal" onclick="switchToTab('personal')">Osobní informace</div>
      <div class="tab" data-tab="news" onclick="switchToTab('news')">Portál vlády</div>
      <div class="tab" data-tab="transactions" id="transactionsTabButton" onclick="switchToTab('transactions')">Transakce</div>
      <div class="tab" data-tab="settings" onclick="switchToTab('settings')">Nastavení</div>
      <div class="tab" data-tab="admin" id="adminTabButton" style="display: none;" onclick="switchToTab('admin')">Administrace</div>
    </div>
    
    <!-- STATUS ZPRÁVY -->
    <div id="statusMessage" class="status-message"></div>
    
    <!-- OSOBNÍ INFORMACE -->
    <div id="personalTab" class="tab-content active">
      <div class="personal-info">
        <h2>Osobní informace</h2>
        <table>
          <tr><td><strong>Přihlášen jako:</strong></td><td id="userName">---</td></tr>
          <tr><td><strong>Člen týmu:</strong></td><td id="userTeam">---</td></tr>
          <tr><td><strong>Spolučlenové:</strong></td><td id="userTeamMembers">---</td></tr>
          <tr><td colspan="2"><hr></td></tr>
          <tr><td colspan="2" style="text-align: center;"><h3>FINANČNÍ STAV</h3></td></tr>
          <tr>
            <td style="text-align: center; width: 50%;">
              <h4>Osobní účet</h4>
              <div style="font-size: 24px; color: #c00;" id="personalBalance">---</div>
              <div id="personalBlock">Blokace: <span id="personalBlockAmount">0</span> ILD</div>
            </td>
            <td style="text-align: center; width: 50%;">
              <h4>Týmový účet</h4>
              <div style="font-size: 24px; color: #c00;" id="teamBalance">---</div>
              <div id="teamBlock">Blokace: <span id="teamBlockAmount">0</span> ILD</div>
            </td>
          </tr>
          <tr><td colspan="2"><hr></td></tr>
          <tr><td><strong>Poslední přihlášení:</strong></td><td id="lastLogin">---</td></tr>
          <tr><td><strong>Poslední uložení dat:</strong></td><td id="lastSave">---</td></tr>
        </table>
      </div>
    </div>
    
    <!-- PORTÁL VLÁDY - NOVINKY -->
    <div id="newsTab" class="tab-content">
      <div class="news-section">
        <h2>Oficiální zprávy vlády SFRI</h2>
        <div id="newsContainer"></div>
      </div>
    </div>
    
    <!-- TRANSAKCE -->
    <div id="transactionsTab" class="tab-content">
      <div class="transactions-section">
        <h2>Správa transakcí</h2>
        <div class="filter-section">
          <select id="transactionFilter" onchange="filterTransactions()">
            <option value="all">Všechny transakce</option>
            <option value="pending">Čekající na schválení</option>
            <option value="approved">Schválené</option>
            <option value="rejected">Zamítnuté</option>
            <option value="sent">Odeslané</option>
            <option value="received">Přijaté</option>
          </select>
          <button onclick="showNewTransactionForm()" style="background: #4caf50;">+ Nová transakce</button>
        </div>
        
        <!-- Formulář pro novou transakci -->
        <div id="newTransactionForm" class="admin-form" style="display: none;">
          <h3>Návrh nové transakce</h3>
          
          <div class="recipient-type-selector">
            <button id="btnToUser" class="active" onclick="selectRecipientType('user')">Uživateli</button>
            <button id="btnToOrganization" onclick="selectRecipientType('organization')">Organizaci</button>
          </div>
          
          <input type="text" id="transactionTitle" placeholder="Název transakce">
          <textarea id="transactionDescription" placeholder="Popis transakce"></textarea>
          
          <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">
            <input type="number" id="transactionAmount" placeholder="Částka (ILD)" style="flex: 1;">
            <div id="amountTypeInfo" style="color: #666; font-size: 0.9em;"></div>
          </div>
          
          <select id="transactionRecipientUser" style="display: block;">
            <option value="">Vyberte uživatele</option>
          </select>
          
          <select id="transactionRecipientOrganization" style="display: none;">
            <option value="">Vyberte organizaci</option>
          </select>
          
          <div style="margin-top: 10px;">
            <button onclick="submitTransaction()">Odeslat ke schválení</button>
            <button onclick="hideNewTransactionForm()" class="secondary">Zrušit</button>
            
            <!-- Admin direct transfer button -->
            <button id="adminDirectTransferBtn" onclick="submitDirectAdminTransfer()" 
                    class="warning" style="display: none;">
              Převést ihned (jako admin)
            </button>
          </div>
        </div>
        
        <!-- Seznam transakcí -->
        <div id="transactionsContainer"></div>
      </div>
    </div>
    
    <!-- NASTAVENÍ -->
    <div id="settingsTab" class="tab-content">
      <div class="settings-section">
        <h2>Nastavení účtu a systému</h2>
        
        <div class="settings-grid">
          <!-- ZMĚNA HESLA -->
          <div class="settings-card">
            <h4>Změna hesla</h4>
            <div class="change-password-form">
              <div id="passwordChangeStatus" class="status-message"></div>
              <input type="password" id="currentPassword" placeholder="Současné heslo">
              <input type="password" id="newPassword" placeholder="Nové heslo">
              <input type="password" id="confirmPassword" placeholder="Potvrďte nové heslo">
              <button onclick="changePassword()" class="success">Změnit heslo</button>
            </div>
          </div>
          
          <!-- ZÁLOHA DAT -->
          <div class="settings-card">
            <h4>Záloha a obnova dat</h4>
            <p>Zálohujte všechna data systému do souboru.</p>
            <div class="backup-controls">
              <button onclick="backupData()" class="success">Vytvořit zálohu</button>
              <button onclick="showRestoreForm()" class="warning">Obnovit ze zálohy</button>
            </div>
            
            <!-- Formulář pro obnovu -->
            <div id="restoreForm" style="display: none; margin-top: 15px;">
              <input type="file" id="backupFile" accept=".json">
              <div style="margin-top: 10px;">
                <button onclick="restoreData()" class="warning">Obnovit data</button>
                <button onclick="hideRestoreForm()" class="secondary">Zrušit</button>
              </div>
              <p style="font-size: 0.9em; color: #666; margin-top: 10px;">
                <strong>Varování:</strong> Obnova přepíše všechna stávající data!
              </p>
            </div>
          </div>
          
          <!-- INFORMACE O SYSTÉMU -->
          <div class="settings-card">
            <h4>Informace o systému</h4>
            <table style="width: 100%;">
              <tr><td><strong>Uživatelů:</strong></td><td id="sysUsersCount">0</td></tr>
              <tr><td><strong>Zpráv:</strong></td><td id="sysNewsCount">0</td></tr>
              <tr><td><strong>Transakcí:</strong></td><td id="sysTransactionsCount">0</td></tr>
              <tr><td><strong>Pokut:</strong></td><td id="sysPenaltiesCount">0</td></tr>
              <tr><td><strong>Poslední záloha:</strong></td><td id="lastBackupTime">Nikdy</td></tr>
              <tr><td><strong>Verze systému:</strong></td><td>SFRI Portál 2.0</td></tr>
            </table>
          </div>
          
          <!-- HISTORIE ZMĚN -->
          <div class="settings-card">
            <h4>Historie změn</h4>
            <div id="changeHistory" style="max-height: 200px; overflow-y: auto; font-size: 0.9em;">
              <!-- Historie změn se načte dynamicky -->
            </div>
            <button onclick="clearChangeHistory()" style="margin-top: 10px; font-size: 0.8em;" class="secondary">Vymazat historii</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ADMINISTRACE -->
    <div id="adminTab" class="tab-content">
      <div class="admin-section">
        <h2>Administrace portálu vlády</h2>
        
        <div class="tabs" style="background: transparent; border-bottom: 1px solid #ddd; margin-bottom: 20px;">
          <div class="tab active" data-admin-tab="users" onclick="switchAdminTab('users')">Správa účtů</div>
          <div class="tab" data-admin-tab="news" onclick="switchAdminTab('news')">Správa zpráv</div>
          <div class="tab" data-admin-tab="transactions" onclick="switchAdminTab('transactions')">Správa transakcí</div>
          <div class="tab" data-admin-tab="penalties" onclick="switchAdminTab('penalties')">Správa pokut</div>
          <div class="tab" data-admin-tab="backup" onclick="switchAdminTab('backup')">Záloha systému</div>
        </div>
        
        <!-- SPRÁVA ÚČTŮ -->
        <div id="adminUsersTab" class="admin-tab-content active">
          <h3>Správa uživatelských účtů</h3>
          
          <div class="admin-form">
            <h4>Vytvořit nový účet</h4>
            <input type="text" id="newUsername" placeholder="Uživatelské jméno">
            <input type="password" id="newPassword" placeholder="Heslo">
            <input type="text" id="newFullName" placeholder="Celé jméno">
            <input type="text" id="newTeam" placeholder="Tým">
            <input type="text" id="newTeamMembers" placeholder="Členové týmu (oddělte čárkou)">
            <input type="number" id="newBalance" placeholder="Počáteční zůstatek (ILD)" value="1000">
            <select id="newIsAdmin">
              <option value="false">Běžný uživatel</option>
              <option value="true">Administrátor</option>
            </select>
            <button onclick="createUser()">Vytvořit účet</button>
          </div>
          
          <h4>Existující účty</h4>
          <div class="accounts-list" id="accountsList"></div>
        </div>
        
        <!-- SPRÁVA ZPRÁV -->
        <div id="adminNewsTab" class="admin-tab-content">
          <h3>Správa zpráv</h3>
          
          <div class="admin-form">
            <h4>Nahrát novou zprávu</h4>
            <input type="text" id="newsTitle" placeholder="Nadpis zprávy">
            <textarea id="newsText" placeholder="Text zprávy"></textarea>
            <div>
              <label for="newsAttachment">Příloha (volitelné):</label>
              <input type="file" id="newsAttachment" accept=".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png">
              <small>Podporované formáty: PDF, DOC, TXT, JPG, PNG</small>
            </div>
            <button onclick="uploadNews()">Zveřejnit zprávu</button>
          </div>
          
          <h4>Existující zprávy</h4>
          <div id="adminNewsList"></div>
        </div>
        
        <!-- SPRÁVA TRANSAKCÍ -->
        <div id="adminTransactionsTab" class="admin-tab-content">
          <h3>Správa transakcí</h3>
          
          <div class="filter-section">
            <select id="adminTransactionFilter" onchange="filterAdminTransactions()">
              <option value="all">Všechny transakce</option>
              <option value="pending">Čekající na schválení</option>
              <option value="approved">Schválené</option>
              <option value="rejected">Zamítnuté</option>
            </select>
            <button onclick="showAdminDirectTransferForm()" style="background: #ff9800;">
              Přímý převod (jako admin)
            </button>
          </div>
          
          <!-- Formulář pro přímý admin převod -->
          <div id="adminDirectTransferForm" class="admin-form" style="display: none;">
            <h4>Přímý převod mezi účty (administrátor)</h4>
            <p><em>Pozor: Tento převod je okamžitý a nevyžaduje schválení!</em></p>
            
            <select id="adminTransferFrom">
              <option value="">Vyberte odesílatele</option>
            </select>
            
            <select id="adminTransferTo">
              <option value="">Vyberte příjemce</option>
            </select>
            
            <div style="display: flex; gap: 10px; align-items: center;">
              <input type="number" id="adminTransferAmount" placeholder="Částka (ILD)" style="flex: 1;">
              <label>
                <input type="checkbox" id="adminTransferNegative"> Negativní částka (pokuta)
              </label>
            </div>
            
            <input type="text" id="adminTransferReason" placeholder="Důvod převodu/pokuty">
            
            <div>
              <button onclick="executeAdminDirectTransfer()" class="warning">Provést převod</button>
              <button onclick="hideAdminDirectTransferForm()" class="secondary">Zrušit</button>
            </div>
          </div>
          
          <div id="adminTransactionsList"></div>
        </div>
        
        <!-- SPRÁVA POKUT -->
        <div id="adminPenaltiesTab" class="admin-tab-content">
          <h3>Správa pokut a sankcí</h3>
          
          <div class="admin-form">
            <h4>Uložit pokutu uživateli</h4>
            <select id="penaltyUser">
              <option value="">Vyberte uživatele</option>
            </select>
            
            <input type="number" id="penaltyAmount" placeholder="Výše pokuty (ILD)" min="1">
            
            <input type="text" id="penaltyReason" placeholder="Důvod pokuty">
            
            <textarea id="penaltyDescription" placeholder="Podrobný popis přestupku" rows="3"></textarea>
            
            <div>
              <button onclick="issuePenalty()" style="background: #f44336;">Uložit pokutu</button>
              <button onclick="showBlockFundsForm()" class="warning">Blokovat prostředky</button>
            </div>
          </div>
          
          <!-- Formulář pro blokaci prostředků -->
          <div id="blockFundsForm" class="admin-form" style="display: none; margin-top: 20px;">
            <h4>Blokovat/odblokovat prostředky</h4>
            
            <select id="blockUser">
              <option value="">Vyberte uživatele</option>
            </select>
            
            <input type="number" id="blockAmount" placeholder="Částka k blokaci/odblokování (ILD)" min="0">
            
            <select id="blockAction">
              <option value="block">Blokovat prostředky</option>
              <option value="unblock">Odblokovat prostředky</option>
            </select>
            
            <input type="text" id="blockReason" placeholder="Důvod blokace/odblokování">
            
            <div>
              <button onclick="executeBlockFunds()" class="warning">Provést</button>
              <button onclick="hideBlockFundsForm()" class="secondary">Zrušit</button>
            </div>
          </div>
          
          <h4>Historie pokut a sankcí</h4>
          <div id="penaltiesHistory"></div>
        </div>
        
        <!-- ZÁLOHA SYSTÉMU -->
        <div id="adminBackupTab" class="admin-tab-content">
          <h3>Záloha a správa dat</h3>
          
          <div class="admin-form">
            <h4>Kompletní záloha systému</h4>
            <p>Uložte všechna data systému do souboru JSON.</p>
            <div class="backup-controls">
              <button onclick="createFullBackup()" class="success">Vytvořit úplnou zálohu</button>
              <button onclick="showImportForm()" class="warning">Importovat data</button>
            </div>
            
            <!-- Formulář pro import -->
            <div id="importForm" style="display: none; margin-top: 15px;">
              <input type="file" id="importFile" accept=".json">
              <div style="margin-top: 10px;">
                <button onclick="importData()" class="warning">Importovat</button>
                <button onclick="hideImportForm()" class="secondary">Zrušit</button>
              </div>
              <p style="font-size: 0.9em; color: #666; margin-top: 10px;">
                <strong>Varování:</strong> Import přepíše všechna stávající data!
              </p>
            </div>
          </div>
          
          <div class="admin-form" style="margin-top: 20px;">
            <h4>Statistiky systému</h4>
            <table style="width: 100%;">
              <tr><td><strong>Celkový počet uživatelů:</strong></td><td id="adminUsersCount">0</td></tr>
              <tr><td><strong>Celkový zůstatek všech účtů:</strong></td><td id="adminTotalBalance">0 ILD</td></tr>
              <tr><td><strong>Celkem blokovaných prostředků:</strong></td><td id="adminTotalBlocked">0 ILD</td></tr>
              <tr><td><strong>Celkem transakcí:</strong></td><td id="adminTotalTransactions">0</td></tr>
              <tr><td><strong>Celkem zpráv:</strong></td><td id="adminTotalNews">0</td></tr>
              <tr><td><strong>Velikost dat v localStorage:</strong></td><td id="adminStorageSize">0 KB</td></tr>
            </table>
          </div>
          
          <div class="admin-form" style="margin-top: 20px; background: #fff3cd; border-color: #ffeaa7;">
            <h4>Nebezpečné operace</h4>
            <p style="color: #856404;">Tyto operace nelze vrátit zpět!</p>
            <div style="margin-top: 10px;">
              <button onclick="resetAllData()" style="background: #dc3545;" onclick="return confirm('Opravdu chcete smazat VŠECHNA data?')">
                Smazat všechna data
              </button>
              <button onclick="exportAllData()" style="background: #17a2b8; margin-left: 10px;">
                Exportovat všechna data
              </button>
            </div>
          </div>
        </div>
        
      </div>
    </div>
    
  </div>

  <script>  
    // GLOBÁLNÍ PROMĚNNÉ
    const users = {};
    let news = [];
    let transactions = [];
    let penalties = [];
    let changeHistory = [];
    
    let currentUser = null;
    let logoutTime = 600;
    let logoutTimerInterval = null;
    let currentRecipientType = "user";
    let autoSaveInterval = null;
    
    // INICIALIZACE SYSTÉMU
    function initializeSystem() {
      console.log("Inicializace systému SFRI Portál...");
      
      // Načíst všechna data z localStorage
      loadAllDataFromStorage();
      
      // Pokud neexistuje admin, vytvořit ho
      if (!users.admin) {
        users.admin = {
          fullName: "Administrátor portálu",
          userName: "admin",
          team: "Administrace",
          teamMembers: "Systémový administrátor",
          personalBalance: 999999999,
          personalBlock: 0,
          teamBalance: "∞",
          teamBlock: 0,
          password: "admin123",
          isAdmin: true
        };
        saveAllData();
        addToChangeHistory("system", "Vytvořen výchozí admin účet", "system");
      }
      
      // Načíst demo data pokud je systém prázdný
      if (Object.keys(users).length === 1) {
        createDemoData();
      }
      
      // Spustit auto-save
      startAutoSave();
    }
    
    // NAČÍST VŠECHNA DATA
    function loadAllDataFromStorage() {
      try {
        // Načíst uživatele
        const savedUsers = localStorage.getItem('sfriUsers');
        if (savedUsers) {
          const parsed = JSON.parse(savedUsers);
          Object.assign(users, parsed);
        }
        
        // Načíst novinky
        const savedNews = localStorage.getItem('sfriNews');
        if (savedNews) {
          news = JSON.parse(savedNews);
        }
        
        // Načíst transakce
        const savedTransactions = localStorage.getItem('sfriTransactions');
        if (savedTransactions) {
          transactions = JSON.parse(savedTransactions);
        }
        
        // Načíst pokuty
        const savedPenalties = localStorage.getItem('sfriPenalties');
        if (savedPenalties) {
          penalties = JSON.parse(savedPenalties);
        }
        
        // Načíst historii změn
        const savedHistory = localStorage.getItem('sfriChangeHistory');
        if (savedHistory) {
          changeHistory = JSON.parse(savedHistory);
        }
        
        console.log("Data úspěšně načtena z localStorage");
      } catch (error) {
        console.error("Chyba při načítání dat:", error);
        showSaveIndicator("Chyba při načítání dat!", true);
      }
    }
    
    // UKLÁDÁNÍ VŠECH DAT
    function saveAllData() {
      try {
        // Uložit všechna data
        localStorage.setItem('sfriUsers', JSON.stringify(users));
        localStorage.setItem('sfriNews', JSON.stringify(news));
        localStorage.setItem('sfriTransactions', JSON.stringify(transactions));
        localStorage.setItem('sfriPenalties', JSON.stringify(penalties));
        localStorage.setItem('sfriChangeHistory', JSON.stringify(changeHistory));
        
        // Aktualizovat čas posledního uložení
        const now = new Date().toLocaleString('cs-CZ');
        localStorage.setItem('sfriLastSave', now);
        
        // Zobrazit indikátor
        showSaveIndicator("Data uložena: " + now);
        
        // Aktualizovat zobrazení
        if (document.getElementById('lastSave')) {
          document.getElementById('lastSave').textContent = now;
        }
        
        console.log("Všechna data uložena:", now);
        return true;
      } catch (error) {
        console.error("Chyba při ukládání dat:", error);
        showSaveIndicator("Chyba při ukládání dat!", true);
        return false;
      }
    }
    
    // UKLÁDÁNÍ JEDNOTLIVÝCH DAT
    function saveUsers() {
      try {
        localStorage.setItem('sfriUsers', JSON.stringify(users));
        addToChangeHistory("users", "Uloženi uživatelé", currentUser);
        return true;
      } catch (error) {
        console.error("Chyba při ukládání uživatelů:", error);
        return false;
      }
    }
    
    function saveNews() {
      try {
        localStorage.setItem('sfriNews', JSON.stringify(news));
        addToChangeHistory("news", "Uloženy zprávy", currentUser);
        return true;
      } catch (error) {
        console.error("Chyba při ukládání zpráv:", error);
        return false;
      }
    }
    
    function saveTransactions() {
      try {
        localStorage.setItem('sfriTransactions', JSON.stringify(transactions));
        addToChangeHistory("transactions", "Uloženy transakce", currentUser);
        return true;
      } catch (error) {
        console.error("Chyba při ukládání transakcí:", error);
        return false;
      }
    }
    
    function savePenalties() {
      try {
        localStorage.setItem('sfriPenalties', JSON.stringify(penalties));
        addToChangeHistory("penalties", "Uloženy pokuty", currentUser);
        return true;
      } catch (error) {
        console.error("Chyba při ukládání pokut:", error);
        return false;
      }
    }
    
    // AUTOMATICKÉ UKLÁDÁNÍ
    function startAutoSave() {
      if (autoSaveInterval) {
        clearInterval(autoSaveInterval);
      }
      
      autoSaveInterval = setInterval(() => {
        if (currentUser) {
          saveAllData();
        }
      }, 30000); // Ukládat každých 30 sekund
      
      console.log("Auto-save spuštěn (každých 30 sekund)");
    }
    
    // ZOBRAZIT INDIKÁTOR UKLÁDÁNÍ
    function showSaveIndicator(message, isError = false) {
      const indicator = document.getElementById('saveIndicator');
      const messageSpan = document.getElementById('saveMessage');
      
      if (indicator && messageSpan) {
        messageSpan.textContent = message;
        indicator.className = isError ? 'save-indicator error' : 'save-indicator';
        indicator.style.display = 'block';
        
        setTimeout(() => {
          indicator.style.display = 'none';
        }, 3000);
      }
    }
    
    // PŘIDAT DO HISTORIE ZMĚN
    function addToChangeHistory(type, description, user) {
      const change = {
        id: changeHistory.length + 1,
        type: type,
        description: description,
        user: user,
        timestamp: new Date().toLocaleString('cs-CZ'),
        date: new Date().toISOString()
      };
      
      changeHistory.unshift(change); // Přidat na začátek
      
      // Omezit historii na 100 záznamů
      if (changeHistory.length > 100) {
        changeHistory = changeHistory.slice(0, 100);
      }
      
      // Uložit historii
      localStorage.setItem('sfriChangeHistory', JSON.stringify(changeHistory));
      
      // Aktualizovat zobrazení historie
      if (document.getElementById('changeHistory')) {
        loadChangeHistory();
      }
    }
    
    // NAČÍST HISTORII ZMĚN
    function loadChangeHistory() {
      const container = document.getElementById('changeHistory');
      if (!container) return;
      
      container.innerHTML = '';
      
      if (changeHistory.length === 0) {
        container.innerHTML = '<p>Žádné změny k zobrazení.</p>';
        return;
      }
      
      changeHistory.forEach(change => {
        const changeDiv = document.createElement('div');
        changeDiv.style.padding = '5px';
        changeDiv.style.borderBottom = '1px solid #eee';
        changeDiv.innerHTML = `
          <div><strong>${change.timestamp}</strong></div>
          <div>${change.description} (${change.user})</div>
        `;
        container.appendChild(changeDiv);
      });
    }
    
    // VYMAZAT HISTORII ZMĚN
    function clearChangeHistory() {
      if (confirm('Opravdu chcete vymazat celou historii změn?')) {
        changeHistory = [];
        localStorage.setItem('sfriChangeHistory', JSON.stringify(changeHistory));
        loadChangeHistory();
        showStatus('Historie změn byla vymazána.', 'success');
      }
    }
    
    // VYTVOŘIT DEMO DATA
    function createDemoData() {
      if (Object.keys(users).length > 1) return; // Už máme data
      
      console.log("Vytváření demo dat...");
      
      // Demo uživatelé
      users.user1 = {
        fullName: "Člen vlády SFRI",
        userName: "Uživatel 1",
        team: "Vláda SFRI",
        teamMembers: "Člen A, Člen B, Člen C",
        personalBalance: 1000000,
        personalBlock: 0,
        teamBalance: "∞",
        teamBlock: 0,
        password: "demo123",
        isAdmin: false
      };
      
      users.user2 = {
        fullName: "Občan Jan Novák",
        userName: "Jan Novák",
        team: "Občané SFRI",
        teamMembers: "Rodina Novák",
        personalBalance: 50000,
        personalBlock: 0,
        teamBalance: "∞",
        teamBlock: 0,
        password: "demo456",
        isAdmin: false
      };
      
      // Demo zprávy
      news = [
        {
          id: 1,
          title: "Vláda SFRI schválila nový rozpočet",
          text: "Vláda Socialistické Federativní Republiky IngLAND dnes schválila rozpočet na příští rok s důrazem na sociální programy a rozvoj infrastruktury.",
          date: new Date().toLocaleString('cs-CZ'),
          author: "admin",
          attachment: null,
          attachmentName: null
        }
      ];
      
      // Demo transakce
      transactions = [
        {
          id: 1,
          title: "Platba za školní pomůcky",
          description: "Nákup učebnic a pomůcek pro základní školy",
          amount: 500000,
          sender: "user1",
          recipient: "Školní úřad",
          recipientType: "organization",
          date: new Date().toLocaleString('cs-CZ'),
          status: "pending",
          approvedBy: null,
          approvedDate: null,
          type: "payment"
        }
      ];
      
      // Uložit všechna data
      saveAllData();
      addToChangeHistory("system", "Vytvořena demo data", "system");
      
      console.log("Demo data vytvořena");
    }
    
    // ZOBRAZIT STATISTIKY SYSTÉMU
    function updateSystemStats() {
      // Základní statistiky
      if (document.getElementById('sysUsersCount')) {
        document.getElementById('sysUsersCount').textContent = Object.keys(users).length;
      }
      
      if (document.getElementById('sysNewsCount')) {
        document.getElementById('sysNewsCount').textContent = news.length;
      }
      
      if (document.getElementById('sysTransactionsCount')) {
        document.getElementById('sysTransactionsCount').textContent = transactions.length;
      }
      
      if (document.getElementById('sysPenaltiesCount')) {
        document.getElementById('sysPenaltiesCount').textContent = penalties.length;
      }
      
      // Admin statistiky
      if (document.getElementById('adminUsersCount')) {
        document.getElementById('adminUsersCount').textContent = Object.keys(users).length;
      }
      
      if (document.getElementById('adminTotalBalance')) {
        const totalBalance = Object.values(users).reduce((sum, user) => sum + user.personalBalance, 0);
        document.getElementById('adminTotalBalance').textContent = totalBalance.toLocaleString() + " ILD";
      }
      
      if (document.getElementById('adminTotalBlocked')) {
        const totalBlocked = Object.values(users).reduce((sum, user) => sum + user.personalBlock, 0);
        document.getElementById('adminTotalBlocked').textContent = totalBlocked.toLocaleString() + " ILD";
      }
      
      if (document.getElementById('adminTotalTransactions')) {
        document.getElementById('adminTotalTransactions').textContent = transactions.length;
      }
      
      if (document.getElementById('adminTotalNews')) {
        document.getElementById('adminTotalNews').textContent = news.length;
      }
      
      if (document.getElementById('adminStorageSize')) {
        let totalSize = 0;
        for (let key in localStorage) {
          if (localStorage.hasOwnProperty(key)) {
            totalSize += localStorage[key].length * 2; // UTF-16
          }
        }
        document.getElementById('adminStorageSize').textContent = (totalSize / 1024).toFixed(2) + " KB";
      }
      
      // Poslední záloha
      if (document.getElementById('lastBackupTime')) {
        const lastBackup = localStorage.getItem('sfriLastBackup') || 'Nikdy';
        document.getElementById('lastBackupTime').textContent = lastBackup;
      }
      
      // Poslední uložení
      if (document.getElementById('lastSave')) {
        const lastSave = localStorage.getItem('sfriLastSave') || 'Nikdy';
        document.getElementById('lastSave').textContent = lastSave;
      }
    }
    
    // ZÁLOHA DAT
    function backupData() {
      try {
        const backup = {
          users: users,
          news: news,
          transactions: transactions,
          penalties: penalties,
          changeHistory: changeHistory,
          timestamp: new Date().toLocaleString('cs-CZ'),
          version: "SFRI Portál 2.0"
        };
        
        const dataStr = JSON.stringify(backup, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `sfri-backup-${new Date().toISOString().slice(0,10)}.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        // Uložit čas zálohy
        localStorage.setItem('sfriLastBackup', new Date().toLocaleString('cs-CZ'));
        
        showStatus('Záloha byla vytvořena a stažena.', 'success');
        addToChangeHistory("backup", "Vytvořena záloha dat", currentUser);
        updateSystemStats();
      } catch (error) {
        console.error("Chyba při vytváření zálohy:", error);
        showStatus('Chyba při vytváření zálohy!', 'error');
      }
    }
    
    function showRestoreForm() {
      document.getElementById('restoreForm').style.display = 'block';
    }
    
    function hideRestoreForm() {
      document.getElementById('restoreForm').style.display = 'none';
    }
    
    function restoreData() {
      const fileInput = document.getElementById('backupFile');
      if (!fileInput.files || fileInput.files.length === 0) {
        showStatus('Vyberte soubor se zálohou!', 'error');
        return;
      }
      
      const file = fileInput.files[0];
      const reader = new FileReader();
      
      reader.onload = function(e) {
        try {
          const backup = JSON.parse(e.target.result);
          
          // Validace zálohy
          if (!backup.users || !backup.news || !backup.transactions || !backup.penalties) {
            throw new Error("Neplatný formát zálohy");
          }
          
          // Potvrzení
          if (!confirm('Opravdu chcete obnovit data ze zálohy? Všechna současná data budou přepsána!')) {
            return;
          }
          
          // Obnovit data
          Object.keys(users).forEach(key => delete users[key]);
          Object.assign(users, backup.users);
          
          news = backup.news;
          transactions = backup.transactions;
          penalties = backup.penalties;
          changeHistory = backup.changeHistory || [];
          
          // Uložit data
          saveAllData();
          
          // Resetovat formulář
          fileInput.value = '';
          hideRestoreForm();
          
          // Přenačíst všechno
          if (currentUser) {
            showPortalForUser(currentUser);
            loadNews();
            loadTransactions();
            if (users[currentUser] && users[currentUser].isAdmin) {
              loadAdminNews();
              loadAccounts();
              loadAdminTransactions();
              loadPenaltiesHistory();
              populateRecipientSelects();
            }
          }
          
          showStatus('Data byla úspěšně obnovena ze zálohy!', 'success');
          addToChangeHistory("restore", "Obnovena data ze zálohy", currentUser);
        } catch (error) {
          console.error("Chyba při obnově dat:", error);
          showStatus('Chyba při obnově dat! Soubor může být poškozený.', 'error');
        }
      };
      
      reader.readAsText(file);
    }
    
    // KOMPLETNÍ ZÁLOHA PRO ADMINA
    function createFullBackup() {
      backupData(); // Použít existující funkci
    }
    
    function showImportForm() {
      document.getElementById('importForm').style.display = 'block';
    }
    
    function hideImportForm() {
      document.getElementById('importForm').style.display = 'none';
    }
    
    function importData() {
      restoreData(); // Použít existující funkci
    }
    
    // EXPORT VŠECH DAT
    function exportAllData() {
      try {
        const exportData = {
          users: users,
          news: news,
          transactions: transactions,
          penalties: penalties,
          changeHistory: changeHistory,
          metadata: {
            exportDate: new Date().toISOString(),
            totalUsers: Object.keys(users).length,
            totalNews: news.length,
            totalTransactions: transactions.length,
            totalPenalties: penalties.length,
            system: "SFRI Portál"
          }
        };
        
        const dataStr = JSON.stringify(exportData, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `sfri-full-export-${new Date().toISOString().slice(0,10)}.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showStatus('Všechna data byla exportována.', 'success');
        addToChangeHistory("export", "Exportována všechna data", currentUser);
      } catch (error) {
        console.error("Chyba při exportu dat:", error);
        showStatus('Chyba při exportu dat!', 'error');
      }
    }
    
    // SMAZAT VŠECHNA DATA
    function resetAllData() {
      if (!confirm('OPRAVDU CHCETE SMAZAT VŠECHNA DATA?\nTuto akci nelze vrátit zpět!\nCelý systém bude resetován do továrního nastavení.')) {
        return;
      }
      
      if (!confirm('JSTE SI NAPROSTO JISTÝ?\nVšechna data budou nenávratně ztracena!')) {
        return;
      }
      
      try {
        // Smazat všechna data z localStorage
        localStorage.clear();
        
        // Resetovat globální proměnné
        Object.keys(users).forEach(key => delete users[key]);
        news = [];
        transactions = [];
        penalties = [];
        changeHistory = [];
        
        // Odhlásit uživatele
        logout();
        
        // Znovu inicializovat systém
        setTimeout(() => {
          initializeSystem();
          alert('Všechna data byla smazána. Systém byl resetován do továrního nastavení.\nBudete přesměrováni na přihlašovací stránku.');
        }, 1000);
        
      } catch (error) {
        console.error("Chyba při resetování dat:", error);
        showStatus('Chyba při resetování dat!', 'error');
      }
    }
    
    // ZMĚNA HESLA
    function changePassword() {
      const currentPass = document.getElementById('currentPassword').value;
      const newPass = document.getElementById('newPassword').value;
      const confirmPass = document.getElementById('confirmPassword').value;
      const statusDiv = document.getElementById('passwordChangeStatus');
      
      // Validace
      if (!currentPass || !newPass || !confirmPass) {
        statusDiv.textContent = 'Vyplňte všechna pole!';
        statusDiv.className = 'status-message status-error';
        statusDiv.style.display = 'block';
        return;
      }
      
      if (newPass !== confirmPass) {
        statusDiv.textContent = 'Nová hesla se neshodují!';
        statusDiv.className = 'status-message status-error';
        statusDiv.style.display = 'block';
        return;
      }
      
      if (newPass.length < 6) {
        statusDiv.textContent = 'Nové heslo musí mít alespoň 6 znaků!';
        statusDiv.className = 'status-message status-error';
        statusDiv.style.display = 'block';
        return;
      }
      
      // Kontrola současného hesla
      const user = users[currentUser];
      if (!user || user.password !== currentPass) {
        statusDiv.textContent = 'Současné heslo je nesprávné!';
        statusDiv.className = 'status-message status-error';
        statusDiv.style.display = 'block';
        return;
      }
      
      // Změnit heslo
      user.password = newPass;
      saveUsers();
      
      // Vyčistit formulář
      document.getElementById('currentPassword').value = '';
      document.getElementById('newPassword').value = '';
      document.getElementById('confirmPassword').value = '';
      
      // Zobrazit úspěch
      statusDiv.textContent = 'Heslo bylo úspěšně změněno!';
      statusDiv.className = 'status-message status-success';
      statusDiv.style.display = 'block';
      
      // Přidat do historie
      addToChangeHistory("password", "Změněno heslo", currentUser);
      
      // Skrýt status po 3 sekundách
      setTimeout(() => {
        statusDiv.style.display = 'none';
      }, 3000);
    }
    
    // ZBYTEK FUNKCÍ Z PŘEDCHOZÍ VERZE...
    // (Zde by pokračoval zbytek kódu z předchozí odpovědi včetně všech funkcí)
    
    // ... pokračování všech předchozích funkcí ...
    
    // PŘIDÁNO: Inicializace systému při načtení stránky
    window.onload = function() {
      initializeSystem();
      updateSystemStats();
      loadChangeHistory();
      
      // Zbytek původního kódu z window.onload...
      const savedUser = localStorage.getItem('loggedInUser');
      
      if (savedUser && users[savedUser]) {
        currentUser = savedUser;
        showPortalForUser(savedUser);
        
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('portalContent').style.display = 'block';
        
        // ZOBRAZIT ADMIN TAB POKUD JE ADMIN
        const adminTabButton = document.getElementById('adminTabButton');
        const transactionsTabButton = document.getElementById('transactionsTabButton');
        if (users[savedUser].isAdmin) {
          adminTabButton.style.display = 'block';
          transactionsTabButton.style.display = 'block';
        } else {
          adminTabButton.style.display = 'none';
          transactionsTabButton.style.display = 'block';
        }
        
        resetLogoutTimer();
        loadNews();
        loadTransactions();
        if (users[savedUser].isAdmin) {
          loadAdminNews();
          loadAccounts();
          loadAdminTransactions();
          populateRecipientSelects();
          loadPenaltiesHistory();
        }
      }
    };
  </script>
</body>
</html>

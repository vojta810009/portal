<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="cs" lang="cs">  
<head>  
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">    
  <title>SFRI.gov - Portál vlády</title>  
  <link href="./styl.css" rel="stylesheet" type="text/css">  
  <link href="style-portal.css" rel="stylesheet" type="text/css">  
  <link href="../datatables/datatables.min.css" rel="stylesheet" type="text/css">  
  <script src="https://code.jquery.com/jquery-latest.js"></script>  
  <script src="../datatables/datatables.min.js"></script>  
  <style>  
    #portalContent { display: none; }  
    #adminContent { display: none; }
    #logoutTimer { font-weight: bold; color: yellow; }  
    #newsSection { margin: 20px; padding: 15px; background: #f5f5f5; border-radius: 5px; }
    .news-item { margin-bottom: 20px; padding: 15px; background: white; border-radius: 5px; border: 1px solid #ddd; }
    .news-image { max-width: 300px; max-height: 200px; margin: 10px 0; }
    .news-text { margin-top: 10px; font-size: 14px; }
    .news-date { font-size: 12px; color: #666; margin-bottom: 5px; }
    #adminUpload { margin: 20px; padding: 20px; background: #f0f0f0; border-radius: 5px; }
    .admin-controls { margin-top: 10px; }
    .delete-btn { background: red; color: white; border: none; padding: 3px 8px; cursor: pointer; margin-left: 10px; }
    
    /* UPRAVENÝ NAVBAR STYL */
    .tabs { 
      display: flex; 
      margin: 0; 
      padding: 10px 20px; 
      background: #f0f0f0; 
      position: relative; 
      z-index: 10; 
      margin-top: 0; 
    }
    .tab { 
      padding: 10px 20px; 
      background: #e0e0e0; 
      cursor: pointer; 
      margin-right: 5px; 
      border-radius: 4px 4px 0 0;
    }
    .tab.active { 
      background: #c00; 
      color: white; 
    }
    .tab-content { 
      display: none; 
      padding: 20px; 
    }
    .tab-content.active { 
      display: block; 
    }
    
    /* UPRAVENÝ LISTA STYL */
    .lista {
      position: relative;
      z-index: 20;
      background: #8b0000;
      color: white;
      padding: 10px 0;
      height: auto;
      min-height: 50px;
    }
    
    .lista table {
      width: 100%;
      table-layout: fixed;
    }
    
    .lista td {
      padding: 5px 10px;
      vertical-align: middle;
    }
    
    .lista button, .lista input[type="submit"] {
      padding: 6px 12px;
      font-size: 14px;
    }
    
    .debug-info { background: #ffeb3b; padding: 5px; margin: 5px; border-radius: 3px; display: none; }
  </style>  
</head>  
<body role="application">
  
  <!-- LOGIN SEKCE -->  
  <div id="loginSection" class="umisteni">  
    <div class="lista"></div>  
    <div class="center">  
      <div class="telo">  
        <h1 style="margin-bottom: 0;">Vítá Vás</h1>  
        <img class="logo" style="width: 250px;" src="SFRI-male.png" alt="Logo SFRI">  
        <h3 style="margin-bottom: 0;font-style: italic;">"Socialistická Federativní Republika IngLAND."</h3>  
        <table style="margin-top: 20px;margin-left: auto;margin-right: auto;padding: 10px 34px;background-color: #fff;border-radius: 9px;border: 1px solid #cecece;">  
          <tbody>  
            <tr><td colspan="2" style="text-align: center;"><h2>Portál vlády SFRI</h2></td></tr>  
            <tr><td>ID občana:</td><td><input type="text" id="username" style="font-size: 20px;width: 135px;"></td></tr>  
            <tr><td>Heslo:</td><td><input type="password" id="password" style="font-size: 20px;width: 135px;"></td></tr>  
            <tr><td></td><td><button onclick="checkLogin()">Přihlásit se</button></td></tr>  
            <tr><td colspan="2" style="text-align: center; padding-top: 10px;">
              <small>Testovací účty:<br>
              user1 / demo123 (běžný uživatel)<br>
              admin / admin123 (administrátor)</small>
            </td></tr>
          </tbody>  
        </table>  
      </div>  
    </div>  
  </div>
  
  <!-- PORTÁL VLÁDY SEKCE -->  
  <div id="portalContent">
    <!-- HORNÍ LIŠTA S INFORMACEMI -->
    <div class="lista">  
      <table>
        <tbody>  
          <tr>  
            <td style="width: 30%;">Přihlášen jako: <b id="userFullName">---</b></td>  
            <td style="width: 20%;">Odhlášení za: <span id="logoutTimer">--:--</span></td>  
            <td style="width: 25%;">
              <button class="podpolozka_aktivni" onclick="switchToTab('news')" style="width: 100%;">PORTÁL VLÁDY</button>
            </td>  
            <td style="width: 15%;">
              <button onclick="logout()" style="width: 100%;">Odhlášení</button>
            </td>  
            <td style="width: 10%;">
              <button onclick="showDebug()" style="background: #ff9800; color: white; width: 100%;">Debug</button>
            </td>
          </tr>  
        </tbody>  
      </table>
    </div>
    
    <div id="debugInfo" class="debug-info">
      <strong>Debug info:</strong>
      <div id="debugContent"></div>
    </div>
    
    <!-- NAVIGAČNÍ ZÁLOŽKY -->
    <div class="tabs">
      <div class="tab active" onclick="switchToTab('personal')">Osobní informace</div>
      <div class="tab" onclick="switchToTab('news')">Portál vlády</div>
      <div class="tab" id="adminTab" onclick="switchToTab('admin')" style="display: none;">Administrace</div>
    </div>
    
    <!-- OSOBNÍ INFORMACE -->
    <div id="personalTab" class="tab-content active">
      <div class="strana">  
        <div class="menu-main">  
          <div class="nazev_strany" id="mainPageTitle">Osobní informace</div>  
          <div id="widgets">  
            <div class="box_nastaveni" id="box_osobni-informace">  
              <h2 onclick="box('osobni-informace');">Osobní informace<div class="sipka"></div></h2>  
              <div class="objekt">  
                <table>  
                  <tbody>  
                    <tr><td>Přihlášen jako:</td><td><b id="userName">---</b></td></tr>  
                    <tr><td>Člen týmu:</td><td><b id="userTeam">---</b></td></tr>  
                    <tr><td>Spolučlenové:</td><td><b id="userTeamMembers">---</b></td></tr>  
                    <tr><td colspan="2" style="text-align: center;">FINANČNÍ STAV</td></tr>  
                    <tr>  
                      <td style="text-align: center;">Osobní účet: <br><div class="KIng" style="margin: auto;"><div id="personalBalance">---</div><div id="personalBlock">---</div></div></td>  
                      <td style="text-align: center;">Týmový účet: <br><div class="KIng" style="margin: auto;"><div id="teamBalance">---</div><div id="teamBlock">---</div></div></td>  
                    </tr>  
                    <tr><td>Poslední přihlášení do administrace: <b id="lastLogin">---</b></td></tr>  
                  </tbody>  
                </table>  
              </div>  
            </div>   
          </div>  
        </div>  
      </div>
    </div>
    
    <!-- PORTÁL VLÁDY - NOVINKY -->
    <div id="newsTab" class="tab-content">
      <div class="strana">
        <div class="menu-main">
          <div class="nazev_strany">Portál vlády - Oficiální zprávy</div>
          <div id="newsSection">
            <!-- Novinky se načtou dynamicky -->
            <div id="newsContainer"></div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ADMINISTRACE -->
    <div id="adminTabContent" class="tab-content">
      <div class="strana">
        <div class="menu-main">
          <div class="nazev_strany">Administrace portálu vlády</div>
          <div id="adminUpload">
            <h3>Nahrát novou zprávu s fotkou</h3>
            <form id="newsUploadForm">
              <div>
                <label for="newsTitle">Nadpis zprávy:</label><br>
                <input type="text" id="newsTitle" style="width: 300px; margin-bottom: 10px;">
              </div>
              <div>
                <label for="newsText">Text zprávy:</label><br>
                <textarea id="newsText" rows="5" style="width: 100%; max-width: 500px; margin-bottom: 10px;"></textarea>
              </div>
              <div>
                <label for="newsImage">Vybrat fotku:</label><br>
                <input type="file" id="newsImage" accept="image/*" style="margin-bottom: 10px;">
              </div>
              <button type="button" onclick="uploadNews()">Nahrát zprávu</button>
            </form>
            
            <h3 style="margin-top: 30px;">Spravovat existující zprávy</h3>
            <div id="adminNewsList">
              <!-- Seznam zpráv pro administraci -->
            </div>
          </div>
        </div>
      </div>
    </div>
    
  </div>

  <script>  
    // Databáze uživatelů
    const users = {
      // Ukázkový uživatel 1
      "user1": {
        fullName: "Člen vlády SFRI",
        userName: "Uživatel 1",
        team: "Vláda SFRI",
        teamMembers: "Člen A, Člen B, Člen C",
        personalBalance: "1000000 ILD",
        personalBlock: "Blokace: 0 ILD",
        teamBalance: "∞ ILD",
        teamBlock: "Blokace: 0 ILD",
        password: "demo123",
        isAdmin: false
      },
      // Ukázkový uživatel 2
      "user2": {
        fullName: "Další člen vlády",
        userName: "Uživatel 2",
        team: "Vláda SFRI",
        teamMembers: "Člen A, Člen B, Člen C",
        personalBalance: "1500000 ILD",
        personalBlock: "Blokace: 0 ILD",
        teamBalance: "∞ ILD",
        teamBlock: "Blokace: 0 ILD",
        password: "demo456",
        isAdmin: false
      },
      // Administrátor
      "admin": {
        fullName: "Administrátor portálu",
        userName: "admin",
        team: "Administrace",
        teamMembers: "Systémový administrátor",
        personalBalance: "999999999 ILD",
        personalBlock: "Blokace: 0 ILD",
        teamBalance: "∞ ILD",
        teamBlock: "Blokace: 0 ILD",
        password: "admin123",
        isAdmin: true
      }
    };
    
    // Demo novinky
    let news = JSON.parse(localStorage.getItem('sfriNews')) || [
      {
        id: 1,
        title: "Vláda SFRI schválila nový rozpočet",
        text: "Vláda Socialistické Federativní Republiky IngLAND dnes schválila rozpočet na příští rok s důrazem na sociální programy a infrastrukturu.",
        image: null,
        date: new Date().toLocaleString('cs-CZ'),
        author: "admin"
      },
      {
        id: 2,
        title: "Slavnostní otevření nové školy",
        text: "Dnes byla slavnostně otevřena nová škola v hlavním městě. Moderní zařízení bude sloužit studentům z celé republiky.",
        image: null,
        date: new Date(Date.now() - 86400000).toLocaleString('cs-CZ'),
        author: "admin"
      }
    ];
    
    let currentUser = null;
    let logoutTime = 600; // 10 minut v sekundách
    let timerInterval;
    
    function showDebug() {
      const debugDiv = document.getElementById('debugInfo');
      const contentDiv = document.getElementById('debugContent');
      
      contentDiv.innerHTML = `
        <div>Aktuální uživatel: ${currentUser || 'žádný'}</div>
        <div>Je admin: ${currentUser ? users[currentUser]?.isAdmin : 'ne'}</div>
        <div>Počet novinek: ${news.length}</div>
        <div>Čas odhlášení: ${logoutTime}s</div>
        <div>Admin tab zobrazen: ${document.getElementById('adminTab').style.display}</div>
      `;
      
      debugDiv.style.display = debugDiv.style.display === 'none' ? 'block' : 'none';
    }
    
    function checkLogin() {  
      let user = document.getElementById("username").value.trim();  
      let pass = document.getElementById("password").value;  
      
      if(users[user] && users[user].password === pass) {  
        currentUser = user;
        localStorage.setItem("loggedInUser", user);  
        localStorage.setItem("lastLogin", new Date().toLocaleString('cs-CZ'));
        showPortalForUser(user);  
        document.getElementById("loginSection").style.display = "none";  
        document.getElementById("portalContent").style.display = "block";
        
        // Zobrazit nebo skrýt admin tab
        const adminTab = document.getElementById('adminTab');
        if(users[user].isAdmin) {
          adminTab.style.display = 'block';
        } else {
          adminTab.style.display = 'none';
        }
        
        resetLogoutTimer();  
        loadNews();
        if(users[user].isAdmin) {
          loadAdminNews();
        }
        
        console.log("Přihlášen uživatel:", user, "Is admin:", users[user].isAdmin);
      } else {  
        alert("Neplatné přihlašovací údaje!");  
      }  
    }  
    
    function showPortalForUser(user) {  
      const u = users[user];  
      document.getElementById("userFullName").innerText = u.fullName;  
      document.getElementById("userName").innerText = u.userName;  
      document.getElementById("userTeam").innerText = u.team;  
      document.getElementById("userTeamMembers").innerText = u.teamMembers;  
      document.getElementById("personalBalance").innerText = u.personalBalance;  
      document.getElementById("personalBlock").innerText = u.personalBlock;  
      document.getElementById("teamBalance").innerText = u.teamBalance;  
      document.getElementById("teamBlock").innerText = u.teamBlock;
      
      const lastLogin = localStorage.getItem("lastLogin") || new Date().toLocaleString('cs-CZ');
      document.getElementById("lastLogin").innerText = lastLogin;
    }  
    
    function switchToTab(tabName) {
      console.log("Přepínám na záložku:", tabName);
      
      // Skrýt všechny záložky
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Deaktivovat všechny taby
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Zobrazit vybranou záložku
      const targetTab = document.getElementById(tabName + 'Tab');
      if (targetTab) {
        targetTab.classList.add('active');
        
        // Aktivovat odpovídající tab
        document.querySelectorAll('.tab').forEach(tab => {
          if (tab.textContent.includes(
            tabName === 'personal' ? 'Osobní' : 
            tabName === 'news' ? 'Portál' : 
            'Administrace')
          ) {
            tab.classList.add('active');
          }
        });
        
        // Pokud přepínáme na administraci, načtěme data
        if(tabName === 'admin' && currentUser && users[currentUser] && users[currentUser].isAdmin) {
          loadAdminNews();
        }
      } else {
        console.error("Záložka neexistuje:", tabName + 'Tab');
      }
    }
    
    function loadNews() {
      const container = document.getElementById('newsContainer');
      container.innerHTML = '';
      
      if(news.length === 0) {
        container.innerHTML = '<p>Zatím nebyly zveřejněny žádné zprávy.</p>';
        return;
      }
      
      // Seřadit novinky od nejnovější
      const sortedNews = [...news].sort((a, b) => new Date(b.date) - new Date(a.date));
      
      sortedNews.forEach(item => {
        const newsDiv = document.createElement('div');
        newsDiv.className = 'news-item';
        newsDiv.innerHTML = `
          <div class="news-date">${item.date} | Autor: ${item.author}</div>
          <h3>${item.title}</h3>
          ${item.image ? `<img src="${item.image}" class="news-image" alt="${item.title}">` : ''}
          <div class="news-text">${item.text}</div>
        `;
        container.appendChild(newsDiv);
      });
    }
    
    function loadAdminNews() {
      const container = document.getElementById('adminNewsList');
      container.innerHTML = '';
      
      if(news.length === 0) {
        container.innerHTML = '<p>Žádné zprávy k zobrazení.</p>';
        return;
      }
      
      // Seřadit novinky od nejnovější
      const sortedNews = [...news].sort((a, b) => new Date(b.date) - new Date(a.date));
      
      sortedNews.forEach(item => {
        const newsDiv = document.createElement('div');
        newsDiv.className = 'news-item';
        newsDiv.innerHTML = `
          <div class="news-date">${item.date} | ID: ${item.id} | Autor: ${item.author}</div>
          <h3>${item.title}</h3>
          ${item.image ? `<img src="${item.image}" class="news-image" style="max-width: 150px;" alt="${item.title}">` : ''}
          <div class="news-text">${item.text}</div>
          <div class="admin-controls">
            <button class="delete-btn" onclick="deleteNews(${item.id})">Smazat</button>
          </div>
        `;
        container.appendChild(newsDiv);
      });
    }
    
    function uploadNews() {
      if(!currentUser || !users[currentUser] || !users[currentUser].isAdmin) {
        alert('Pouze administrátor může nahrávat zprávy!');
        return;
      }
      
      const title = document.getElementById('newsTitle').value.trim();
      const text = document.getElementById('newsText').value.trim();
      const imageInput = document.getElementById('newsImage');
      
      if(!title || !text) {
        alert('Vyplňte nadpis a text zprávy!');
        return;
      }
      
      // Najít nejvyšší ID
      const maxId = news.length > 0 ? Math.max(...news.map(n => n.id)) : 0;
      const newId = maxId + 1;
      
      const newItem = {
        id: newId,
        title: title,
        text: text,
        image: null,
        date: new Date().toLocaleString('cs-CZ'),
        author: currentUser
      };
      
      // Zpracování obrázku pokud je nahrán
      if(imageInput.files && imageInput.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          newItem.image = e.target.result;
          addNewsItem(newItem);
        };
        reader.readAsDataURL(imageInput.files[0]);
      } else {
        addNewsItem(newItem);
      }
    }
    
    function addNewsItem(newItem) {
      news.push(newItem);
      localStorage.setItem('sfriNews', JSON.stringify(news));
      
      // Reset formuláře
      document.getElementById('newsTitle').value = '';
      document.getElementById('newsText').value = '';
      document.getElementById('newsImage').value = '';
      
      // Přenačíst zprávy
      loadNews();
      loadAdminNews();
      
      alert('Zpráva byla úspěšně nahrána!');
    }
    
    function deleteNews(id) {
      if(!confirm('Opravdu chcete smazat tuto zprávu?')) return;
      
      news = news.filter(item => item.id !== id);
      localStorage.setItem('sfriNews', JSON.stringify(news));
      
      loadNews();
      loadAdminNews();
      alert('Zpráva byla smazána.');
    }
    
    function logout() {  
      localStorage.removeItem("loggedInUser");  
      document.getElementById("portalContent").style.display = "none";  
      document.getElementById("loginSection").style.display = "block";  
      document.getElementById("logoutTimer").innerText = "--:--";  
      clearInterval(timerInterval);
      currentUser = null;
      
      // Resetovat formulář
      document.getElementById("username").value = "";
      document.getElementById("password").value = "";
    }  
    
    function resetLogoutTimer() {
      logoutTime = 600; // Reset na 10 minut
      clearInterval(timerInterval);
      updateLogoutTimer();
      
      timerInterval = setInterval(function() {
        logoutTime--;
        updateLogoutTimer();
        
        if(logoutTime <= 0) {
          logout();
          alert('Byl jste automaticky odhlášen z důvodu nečinnosti.');
        }
      }, 1000);
    }
    
    function updateLogoutTimer() {
      const minutes = Math.floor(logoutTime / 60);
      const seconds = logoutTime % 60;
      document.getElementById('logoutTimer').innerText = 
        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }
    
    function box(id) {  
      var el = document.getElementById('box_' + id);  
      if (el.className === 'box_nastaveni') el.className = 'box_nastaveni closed';  
      else el.className = 'box_nastaveni';  
    }
    
    // Přidání klávesové zkratky pro přihlášení (Enter)
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('password').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          checkLogin();
        }
      });
      
      document.getElementById('username').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          checkLogin();
        }
      });
    });
    
    window.onload = function() {  
      let loggedUser = localStorage.getItem("loggedInUser");  
      if(loggedUser && users[loggedUser]) {  
        currentUser = loggedUser;
        showPortalForUser(loggedUser);  
        document.getElementById("loginSection").style.display = "none";  
        document.getElementById("portalContent").style.display = "block";
        
        // Zobrazit nebo skrýt admin tab
        const adminTab = document.getElementById('adminTab');
        if(users[loggedUser].isAdmin) {
          adminTab.style.display = 'block';
        } else {
          adminTab.style.display = 'none';
        }
        
        resetLogoutTimer();  
        loadNews();
        if(users[loggedUser].isAdmin) {
          loadAdminNews();
        }
        
        console.log("Automaticky přihlášen:", loggedUser, "Is admin:", users[loggedUser].isAdmin);
      }
      
      // Načíst novinky z localStorage
      const savedNews = localStorage.getItem('sfriNews');
      if(savedNews) {
        try {
          news = JSON.parse(savedNews);
        } catch(e) {
          console.error("Chyba při načítání novinek:", e);
          news = [];
        }
      }
    }  
    
  </script>  
</body>  
</html>

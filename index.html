<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="cs" lang="cs">  
<head>  
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">    
  <title>SFRI.gov - Portál vlády</title>  
  <style>  
    #portalContent { display: none; }  
    #logoutTimer { font-weight: bold; color: yellow; }  
    
    /* ZÁKLADNÍ STYLY */
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: #f5f5f5;
    }
    
    /* HORNÍ LIŠTA */
    .top-bar {
      background: #8b0000;
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    
    .top-bar-info {
      display: flex;
      gap: 20px;
      align-items: center;
    }
    
    .top-bar-buttons {
      display: flex;
      gap: 10px;
    }
    
    .top-bar button {
      background: #c00;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }
    
    .top-bar button:hover {
      background: #a00;
    }
    
    /* ZÁLOŽKY */
    .tabs { 
      display: flex; 
      background: #e0e0e0; 
      padding: 0 20px;
      border-bottom: 2px solid #c00;
      flex-wrap: wrap;
    }
    
    .tab { 
      padding: 12px 24px; 
      background: #d0d0d0; 
      cursor: pointer; 
      margin-right: 2px; 
      border-radius: 5px 5px 0 0;
      font-weight: bold;
      white-space: nowrap;
    }
    
    .tab:hover { 
      background: #c0c0c0; 
    }
    
    .tab.active { 
      background: #c00; 
      color: white; 
    }
    
    /* OBSAH */
    .tab-content { 
      display: none; 
      padding: 20px; 
      min-height: 400px;
    }
    
    .tab-content.active { 
      display: block; 
    }
    
    /* OSOBNÍ INFORMACE */
    .personal-info {
      background: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .personal-info table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .personal-info td {
      padding: 8px;
      border-bottom: 1px solid #eee;
    }
    
    /* NOVINKY */
    .news-section {
      background: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .news-item {
      margin-bottom: 20px;
      padding: 15px;
      border-left: 4px solid #c00;
      background: #f9f9f9;
    }
    
    .news-title {
      color: #c00;
      margin: 0 0 10px 0;
    }
    
    .news-date {
      color: #666;
      font-size: 0.9em;
      margin-bottom: 10px;
    }
    
    .news-text {
      line-height: 1.5;
    }
    
    .news-attachment {
      margin-top: 10px;
      padding: 8px;
      background: #e9e9e9;
      border-radius: 4px;
      font-size: 0.9em;
    }
    
    .news-attachment a {
      color: #c00;
      text-decoration: none;
      font-weight: bold;
    }
    
    .news-attachment a:hover {
      text-decoration: underline;
    }
    
    /* ADMINISTRACE - OBECNÉ */
    .admin-section {
      background: white;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .admin-form {
      margin-bottom: 30px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 5px;
    }
    
    .admin-form input[type="text"],
    .admin-form input[type="password"],
    .admin-form input[type="number"],
    .admin-form select,
    .admin-form textarea {
      width: 100%;
      max-width: 500px;
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
      box-sizing: border-box;
    }
    
    .admin-form textarea {
      height: 100px;
      resize: vertical;
    }
    
    .admin-form button {
      background: #c00;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      font-size: 16px;
      margin-right: 10px;
      margin-bottom: 5px;
    }
    
    .admin-form button:hover {
      background: #a00;
    }
    
    .admin-form button.secondary {
      background: #666;
    }
    
    .admin-form button.secondary:hover {
      background: #555;
    }
    
    .admin-form button.warning {
      background: #ff9800;
    }
    
    .admin-form button.warning:hover {
      background: #f57c00;
    }
    
    .admin-form button.success {
      background: #4caf50;
    }
    
    .admin-form button.success:hover {
      background: #45a049;
    }
    
    /* LOGIN */
    .login-section {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #8b0000 0%, #c00 100%);
    }
    
    .login-box {
      background: white;
      padding: 40px;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      text-align: center;
      max-width: 400px;
      width: 90%;
    }
    
    .login-box h1 {
      color: #8b0000;
      margin-bottom: 20px;
    }
    
    .login-box input[type="text"],
    .login-box input[type="password"] {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
      box-sizing: border-box;
    }
    
    .login-box button {
      background: #c00;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      margin-top: 10px;
      width: 100%;
    }
    
    .login-box button:hover {
      background: #a00;
    }
    
    .login-logo {
      width: 200px;
      margin-bottom: 20px;
    }
    
    /* STATUS ZPRÁVY */
    .status-message {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      display: none;
    }
    
    .status-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .status-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    /* SAVE INDICATOR */
    .save-indicator {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #4caf50;
      color: white;
      padding: 10px 15px;
      border-radius: 5px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      display: none;
      z-index: 1000;
    }
    
    .save-indicator.error {
      background: #f44336;
    }
  </style>  
</head>  
<body role="application">
  
  <!-- INDIKÁTOR UKLÁDÁNÍ -->
  <div id="saveIndicator" class="save-indicator">
    <span id="saveMessage">Ukládám...</span>
  </div>
  
  <!-- LOGIN SEKCE -->  
  <div id="loginSection" class="login-section">
    <div class="login-box">
      <h1>Vítejte v Portálu vlády SFRI</h1>
      <div style="background: #8b0000; color: white; padding: 10px; border-radius: 5px; margin-bottom: 20px;">
        SFRI - Socialistická Federativní Republika IngLAND
      </div>
      
      <div id="loginStatus" class="status-message"></div>
      
      <input type="text" id="username" placeholder="ID občana" value="admin">
      <input type="password" id="password" placeholder="Heslo" value="admin123">
      <button onclick="checkLogin()">Přihlásit se</button>
      
      <div style="margin-top: 20px; font-size: 14px; color: #666;">
        <strong>Testovací účty:</strong><br>
        • admin / admin123 (administrátor)<br>
        • user1 / demo123 (běžný uživatel)<br>
        • user2 / demo456 (běžný uživatel)
      </div>
    </div>
  </div>
  
  <!-- PORTÁL VLÁDY SEKCE -->  
  <div id="portalContent">
    <!-- HORNÍ LIŠTA -->
    <div class="top-bar">
      <div class="top-bar-info">
        Přihlášen jako: <strong id="userFullName">---</strong>
        | Odhlášení za: <strong id="logoutTimer">--:--</strong>
      </div>
      <div class="top-bar-buttons">
        <button onclick="switchToTab('news')">Portál vlády</button>
        <button onclick="logout()">Odhlášení</button>
      </div>
    </div>
    
    <!-- NAVIGAČNÍ ZÁLOŽKY -->
    <div class="tabs">
      <div class="tab active" data-tab="personal" onclick="switchToTab('personal')">Osobní informace</div>
      <div class="tab" data-tab="news" onclick="switchToTab('news')">Portál vlády</div>
      <div class="tab" data-tab="transactions" id="transactionsTabButton" onclick="switchToTab('transactions')">Transakce</div>
      <div class="tab" data-tab="admin" id="adminTabButton" style="display: none;" onclick="switchToTab('admin')">Administrace</div>
    </div>
    
    <!-- STATUS ZPRÁVY -->
    <div id="statusMessage" class="status-message"></div>
    
    <!-- OSOBNÍ INFORMACE -->
    <div id="personalTab" class="tab-content active">
      <div class="personal-info">
        <h2>Osobní informace</h2>
        <table>
          <tr><td><strong>Přihlášen jako:</strong></td><td id="userName">---</td></tr>
          <tr><td><strong>Člen týmu:</strong></td><td id="userTeam">---</td></tr>
          <tr><td><strong>Spolučlenové:</strong></td><td id="userTeamMembers">---</td></tr>
          <tr><td colspan="2"><hr></td></tr>
          <tr><td colspan="2" style="text-align: center;"><h3>FINANČNÍ STAV</h3></td></tr>
          <tr>
            <td style="text-align: center; width: 50%;">
              <h4>Osobní účet</h4>
              <div style="font-size: 24px; color: #c00;" id="personalBalance">---</div>
              <div id="personalBlock">Blokace: <span id="personalBlockAmount">0</span> ILD</div>
            </td>
            <td style="text-align: center; width: 50%;">
              <h4>Týmový účet</h4>
              <div style="font-size: 24px; color: #c00;" id="teamBalance">---</div>
              <div id="teamBlock">Blokace: <span id="teamBlockAmount">0</span> ILD</div>
            </td>
          </tr>
          <tr><td colspan="2"><hr></td></tr>
          <tr><td><strong>Poslední přihlášení:</strong></td><td id="lastLogin">---</td></tr>
        </table>
      </div>
    </div>
    
    <!-- PORTÁL VLÁDY - NOVINKY -->
    <div id="newsTab" class="tab-content">
      <div class="news-section">
        <h2>Oficiální zprávy vlády SFRI</h2>
        <div id="newsContainer">
          <p>Načítám zprávy...</p>
        </div>
      </div>
    </div>
    
    <!-- TRANSAKCE -->
    <div id="transactionsTab" class="tab-content">
      <div class="news-section">
        <h2>Správa transakcí</h2>
        <div id="transactionsContainer">
          <p>Načítám transakce...</p>
        </div>
      </div>
    </div>
    
    <!-- ADMINISTRACE -->
    <div id="adminTab" class="tab-content">
      <div class="admin-section">
        <h2>Administrace portálu vlády</h2>
        <div id="adminContent">
          <p>Administrační rozhraní se načte po přihlášení jako admin.</p>
        </div>
      </div>
    </div>
    
  </div>

  <script>  
    // GLOBÁLNÍ PROMĚNNÉ
    let users = {};
    let news = [];
    let transactions = [];
    let currentUser = null;
    let logoutTime = 600;
    let logoutTimerInterval = null;
    
    // INICIALIZACE SYSTÉMU
    function initializeSystem() {
      console.log("Inicializace systému...");
      
      // Načíst data z localStorage
      loadDataFromStorage();
      
      // Pokud neexistují uživatelé, vytvořit výchozí
      if (Object.keys(users).length === 0) {
        createDefaultUsers();
        saveAllData();
      }
      
      // Zkontrolovat auto-přihlášení
      checkAutoLogin();
    }
    
    // NAČÍST DATA Z LOCALSTORAGE
    function loadDataFromStorage() {
      try {
        // Načíst uživatele
        const savedUsers = localStorage.getItem('sfriUsers');
        if (savedUsers) {
          users = JSON.parse(savedUsers);
          console.log("Načteni uživatelé:", Object.keys(users).length);
        }
        
        // Načíst novinky
        const savedNews = localStorage.getItem('sfriNews');
        if (savedNews) {
          news = JSON.parse(savedNews);
          console.log("Načteny zprávy:", news.length);
        }
        
        // Načíst transakce
        const savedTransactions = localStorage.getItem('sfriTransactions');
        if (savedTransactions) {
          transactions = JSON.parse(savedTransactions);
          console.log("Načteny transakce:", transactions.length);
        }
      } catch (error) {
        console.error("Chyba při načítání dat:", error);
        showLoginStatus("Chyba při načítání dat. Zkuste obnovit stránku.", true);
      }
    }
    
    // VYTVOŘIT VÝCHOZÍ UŽIVATELE
    function createDefaultUsers() {
      console.log("Vytváření výchozích uživatelů...");
      
      users = {
        "admin": {
          fullName: "Administrátor portálu",
          userName: "admin",
          team: "Administrace",
          teamMembers: "Systémový administrátor",
          personalBalance: 999999999,
          personalBlock: 0,
          teamBalance: "∞",
          teamBlock: 0,
          password: "admin123",
          isAdmin: true
        },
        "user1": {
          fullName: "Člen vlády SFRI",
          userName: "Uživatel 1",
          team: "Vláda SFRI",
          teamMembers: "Člen A, Člen B, Člen C",
          personalBalance: 1000000,
          personalBlock: 0,
          teamBalance: "∞",
          teamBlock: 0,
          password: "demo123",
          isAdmin: false
        },
        "user2": {
          fullName: "Občan Jan Novák",
          userName: "Jan Novák",
          team: "Občané SFRI",
          teamMembers: "Rodina Novák",
          personalBalance: 50000,
          personalBlock: 0,
          teamBalance: "∞",
          teamBlock: 0,
          password: "demo456",
          isAdmin: false
        }
      };
      
      // Vytvořit demo zprávy
      news = [
        {
          id: 1,
          title: "Vítejte v Portálu vlády SFRI",
          text: "Vláda Socialistické Federativní Republiky IngLAND vás vítá v novém portálu pro správu vládních záležitostí.",
          date: new Date().toLocaleString('cs-CZ'),
          author: "admin"
        }
      ];
      
      // Vytvořit demo transakce
      transactions = [
        {
          id: 1,
          title: "První testovací transakce",
          description: "Testovací transakce pro ověření funkčnosti systému",
          amount: 1000,
          sender: "admin",
          recipient: "user1",
          recipientType: "user",
          date: new Date().toLocaleString('cs-CZ'),
          status: "approved",
          approvedBy: "admin",
          type: "transfer"
        }
      ];
    }
    
    // UKLÁDÁNÍ DAT
    function saveAllData() {
      try {
        localStorage.setItem('sfriUsers', JSON.stringify(users));
        localStorage.setItem('sfriNews', JSON.stringify(news));
        localStorage.setItem('sfriTransactions', JSON.stringify(transactions));
        showSaveIndicator("Data uložena");
        return true;
      } catch (error) {
        console.error("Chyba při ukládání:", error);
        showSaveIndicator("Chyba při ukládání!", true);
        return false;
      }
    }
    
    // ZOBRAZIT INDIKÁTOR UKLÁDÁNÍ
    function showSaveIndicator(message, isError = false) {
      const indicator = document.getElementById('saveIndicator');
      const messageSpan = document.getElementById('saveMessage');
      
      if (indicator && messageSpan) {
        messageSpan.textContent = message;
        indicator.className = isError ? 'save-indicator error' : 'save-indicator';
        indicator.style.display = 'block';
        
        setTimeout(() => {
          indicator.style.display = 'none';
        }, 2000);
      }
    }
    
    // ZOBRAZIT STATUS PŘIHLÁŠENÍ
    function showLoginStatus(message, isError = false) {
      const statusDiv = document.getElementById('loginStatus');
      if (statusDiv) {
        statusDiv.textContent = message;
        statusDiv.className = isError ? 'status-message status-error' : 'status-message status-success';
        statusDiv.style.display = 'block';
      }
    }
    
    // KONTROLA AUTO-PŘIHLÁŠENÍ
    function checkAutoLogin() {
      const savedUser = localStorage.getItem('loggedInUser');
      if (savedUser && users[savedUser]) {
        console.log("Auto-přihlášení pro:", savedUser);
        performLogin(savedUser);
      }
    }
    
    // PŘIHLÁŠENÍ
    function checkLogin() {
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      
      if (!username || !password) {
        showLoginStatus("Vyplňte uživatelské jméno i heslo!", true);
        return;
      }
      
      console.log("Pokus o přihlášení:", username);
      
      if (users[username] && users[username].password === password) {
        performLogin(username);
      } else {
        showLoginStatus("Neplatné přihlašovací údaje!", true);
      }
    }
    
    // PROVEDENÍ PŘIHLÁŠENÍ
    function performLogin(username) {
      console.log("Přihlašuji uživatele:", username);
      currentUser = username;
      
      // Uložit přihlášení
      localStorage.setItem('loggedInUser', username);
      localStorage.setItem('lastLogin', new Date().toLocaleString('cs-CZ'));
      
      // Skrýt login, zobrazit portál
      document.getElementById('loginSection').style.display = 'none';
      document.getElementById('portalContent').style.display = 'block';
      
      // Načíst data uživatele
      showPortalForUser(username);
      
      // Zobrazit/skrýt admin tab
      const adminTabButton = document.getElementById('adminTabButton');
      if (users[username].isAdmin) {
        adminTabButton.style.display = 'block';
      } else {
        adminTabButton.style.display = 'none';
      }
      
      // Spustit timer odhlášení
      resetLogoutTimer();
      
      // Načíst obsah
      loadNews();
      loadTransactions();
      
      // Zobrazit status
      showStatus(`Vítejte, ${username}!`);
      
      console.log("Přihlášení úspěšné");
    }
    
    // ZOBRAZIT STATUS
    function showStatus(message, type = 'success') {
      const statusDiv = document.getElementById('statusMessage');
      if (statusDiv) {
        statusDiv.textContent = message;
        statusDiv.className = `status-message status-${type}`;
        statusDiv.style.display = 'block';
        
        setTimeout(() => {
          statusDiv.style.display = 'none';
        }, 3000);
      }
    }
    
    // ZOBRAZIT PORTÁL PRO UŽIVATELE
    function showPortalForUser(username) {
      const user = users[username];
      if (!user) return;
      
      document.getElementById('userFullName').textContent = user.fullName;
      document.getElementById('userName').textContent = user.userName;
      document.getElementById('userTeam').textContent = user.team;
      document.getElementById('userTeamMembers').textContent = user.teamMembers;
      document.getElementById('personalBalance').textContent = user.personalBalance.toLocaleString() + " ILD";
      document.getElementById('personalBlockAmount').textContent = user.personalBlock;
      document.getElementById('teamBalance').textContent = user.teamBalance + " ILD";
      document.getElementById('teamBlockAmount').textContent = user.teamBlock;
      
      const lastLogin = localStorage.getItem('lastLogin') || new Date().toLocaleString('cs-CZ');
      document.getElementById('lastLogin').textContent = lastLogin;
    }
    
    // PŘEPÍNÁNÍ ZÁLOŽEK
    function switchToTab(tabName) {
      console.log("Přepínám na:", tabName);
      
      // Kontrola přístupu pro admin
      if (tabName === 'admin' && (!currentUser || !users[currentUser] || !users[currentUser].isAdmin)) {
        showStatus('Nemáte oprávnění pro přístup do administrace!', 'error');
        return;
      }
      
      // Skrýt všechny záložky
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Deaktivovat všechny taby
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Zobrazit vybranou záložku
      const targetTab = document.getElementById(tabName + 'Tab');
      if (targetTab) {
        targetTab.classList.add('active');
        
        // Aktivovat odpovídající tab
        const tabElement = document.querySelector(`.tab[data-tab="${tabName}"]`);
        if (tabElement) {
          tabElement.classList.add('active');
        }
        
        // Načíst specifická data
        if (tabName === 'admin') {
          loadAdminContent();
        }
      }
    }
    
    // NAČÍST NOVINKY
    function loadNews() {
      const container = document.getElementById('newsContainer');
      if (!container) return;
      
      container.innerHTML = '';
      
      if (news.length === 0) {
        container.innerHTML = '<p>Zatím nebyly publikovány žádné zprávy.</p>';
        return;
      }
      
      const sortedNews = [...news].sort((a, b) => new Date(b.date) - new Date(a.date));
      
      sortedNews.forEach(item => {
        const newsDiv = document.createElement('div');
        newsDiv.className = 'news-item';
        newsDiv.innerHTML = `
          <div class="news-date"><strong>${item.date}</strong> | Autor: ${item.author}</div>
          <h3 class="news-title">${item.title}</h3>
          <div class="news-text">${item.text}</div>
        `;
        container.appendChild(newsDiv);
      });
    }
    
    // NAČÍST TRANSAKCE
    function loadTransactions() {
      const container = document.getElementById('transactionsContainer');
      if (!container) return;
      
      container.innerHTML = '';
      
      if (transactions.length === 0) {
        container.innerHTML = '<p>Žádné transakce k zobrazení.</p>';
        return;
      }
      
      // Filtrovat transakce pro aktuálního uživatele
      const userTransactions = transactions.filter(t => 
        t.sender === currentUser || t.recipient === currentUser
      );
      
      if (userTransactions.length === 0) {
        container.innerHTML = '<p>Nemáte žádné transakce.</p>';
        return;
      }
      
      const sortedTransactions = [...userTransactions].sort((a, b) => new Date(b.date) - new Date(a.date));
      
      sortedTransactions.forEach(transaction => {
        const transactionDiv = document.createElement('div');
        transactionDiv.className = 'news-item';
        
        let statusText = '';
        let statusColor = '';
        switch(transaction.status) {
          case 'pending':
            statusText = 'Čeká na schválení';
            statusColor = '#ff9800';
            break;
          case 'approved':
            statusText = 'Schváleno';
            statusColor = '#4caf50';
            break;
          case 'rejected':
            statusText = 'Zamítnuto';
            statusColor = '#f44336';
            break;
        }
        
        transactionDiv.innerHTML = `
          <div class="news-date"><strong>${transaction.date}</strong></div>
          <h3 class="news-title">${transaction.title}</h3>
          <div class="news-text">${transaction.description}</div>
          <div><strong>Částka:</strong> ${transaction.amount.toLocaleString()} ILD</div>
          <div><strong>Stav:</strong> <span style="color: ${statusColor}; font-weight: bold;">${statusText}</span></div>
          <div><strong>${transaction.sender === currentUser ? 'Příjemce' : 'Odesílatel'}:</strong> ${transaction.recipient}</div>
        `;
        container.appendChild(transactionDiv);
      });
    }
    
    // NAČÍST ADMIN OBSAH
    function loadAdminContent() {
      const container = document.getElementById('adminContent');
      if (!container) return;
      
      let html = `
        <div class="admin-form">
          <h3>Správa uživatelů</h3>
          <p><strong>Počet uživatelů:</strong> ${Object.keys(users).length}</p>
          <button onclick="showCreateUserForm()">Vytvořit nového uživatele</button>
        </div>
        
        <div class="admin-form">
          <h3>Správa zpráv</h3>
          <p><strong>Počet zpráv:</strong> ${news.length}</p>
          <button onclick="showCreateNewsForm()">Vytvořit novou zprávu</button>
        </div>
        
        <div class="admin-form">
          <h3>Správa transakcí</h3>
          <p><strong>Počet transakcí:</strong> ${transactions.length}</p>
        </div>
        
        <div class="admin-form">
          <h3>Systémové funkce</h3>
          <button onclick="backupData()" class="success">Vytvořit zálohu</button>
          <button onclick="resetData()" class="warning" style="margin-left: 10px;">Resetovat data</button>
        </div>
      `;
      
      container.innerHTML = html;
    }
    
    // VYTVOŘIT NOVÉHO UŽIVATELE (admin funkce)
    function showCreateUserForm() {
      const username = prompt("Uživatelské jméno:");
      if (!username) return;
      
      const password = prompt("Heslo:");
      if (!password) return;
      
      const fullName = prompt("Celé jméno:");
      if (!fullName) return;
      
      const isAdmin = confirm("Je tento uživatel administrátor?");
      
      users[username] = {
        fullName: fullName,
        userName: username,
        team: "Nový tým",
        teamMembers: "Členové",
        personalBalance: 1000,
        personalBlock: 0,
        teamBalance: "∞",
        teamBlock: 0,
        password: password,
        isAdmin: isAdmin
      };
      
      saveAllData();
      showStatus(`Uživatel ${username} byl vytvořen.`);
      loadAdminContent();
    }
    
    // VYTVOŘIT NOVOU ZPRÁVU (admin funkce)
    function showCreateNewsForm() {
      const title = prompt("Nadpis zprávy:");
      if (!title) return;
      
      const text = prompt("Text zprávy:");
      if (!text) return;
      
      const newId = news.length > 0 ? Math.max(...news.map(n => n.id)) + 1 : 1;
      const newItem = {
        id: newId,
        title: title,
        text: text,
        date: new Date().toLocaleString('cs-CZ'),
        author: currentUser
      };
      
      news.push(newItem);
      saveAllData();
      showStatus("Zpráva byla vytvořena.");
      loadNews();
      loadAdminContent();
    }
    
    // ZÁLOHA DAT
    function backupData() {
      try {
        const backup = {
          users: users,
          news: news,
          transactions: transactions,
          timestamp: new Date().toLocaleString('cs-CZ')
        };
        
        const dataStr = JSON.stringify(backup, null, 2);
        const dataBlob = new Blob([dataStr], {type: 'application/json'});
        
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `sfri-backup-${new Date().toISOString().slice(0,10)}.json`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showStatus('Záloha byla vytvořena a stažena.', 'success');
      } catch (error) {
        console.error("Chyba při vytváření zálohy:", error);
        showStatus('Chyba při vytváření zálohy!', 'error');
      }
    }
    
    // RESET DAT
    function resetData() {
      if (confirm('Opravdu chcete resetovat všechna data? Tuto akci nelze vrátit zpět!')) {
        localStorage.clear();
        location.reload();
      }
    }
    
    // ODHLÁŠENÍ
    function logout() {
      currentUser = null;
      localStorage.removeItem('loggedInUser');
      
      document.getElementById('portalContent').style.display = 'none';
      document.getElementById('loginSection').style.display = 'flex';
      
      // Resetovat formulář
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
      document.getElementById('loginStatus').style.display = 'none';
      
      // Zastavit timer
      if (logoutTimerInterval) {
        clearInterval(logoutTimerInterval);
      }
      document.getElementById('logoutTimer').textContent = '--:--';
      
      showLoginStatus("Byli jste odhlášeni.", false);
    }
    
    // TIMER ODHLÁŠENÍ
    function resetLogoutTimer() {
      logoutTime = 600;
      if (logoutTimerInterval) {
        clearInterval(logoutTimerInterval);
      }
      updateLogoutTimer();
      
      logoutTimerInterval = setInterval(() => {
        logoutTime--;
        updateLogoutTimer();
        
        if (logoutTime <= 0) {
          logout();
          alert('Byl jste automaticky odhlášen z důvodu nečinnosti.');
        }
      }, 1000);
    }
    
    function updateLogoutTimer() {
      const minutes = Math.floor(logoutTime / 60);
      const seconds = logoutTime % 60;
      document.getElementById('logoutTimer').textContent = 
        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    }
    
    // ENTER PRO PŘIHLÁŠENÍ
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('password').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          checkLogin();
        }
      });
      
      document.getElementById('username').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          checkLogin();
        }
      });
    });
    
    // INICIALIZACE PŘI NAČTENÍ STRÁNKY
    window.onload = function() {
      console.log("Stránka načtena, inicializace systému...");
      initializeSystem();
    };
  </script>
</body>
</html>
